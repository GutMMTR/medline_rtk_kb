<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title or "Медлайн.РТК.КБ" }}</title>
    <link rel="stylesheet" href="/static/app.css?v=23" />
    <link rel="icon" href="/static/brand/rtk_mark.svg" type="image/svg+xml" />
  </head>
  <body>
    <div class="topbar">
      <a class="brand" href="/">
        <img
          class="brand-logo"
          src="/static/brand/rtk_full.png"
          alt="Ростелеком"
          onerror="this.onerror=null;this.src='/static/brand/rtk_full.svg';"
        />
      </a>
      {% if user %}
      <div class="topbar-right">
        <span class="muted">Пользователь:</span> {{ user.login }}
        {% if user.is_admin %}
          <span class="badge">admin</span>
        {% endif %}
        <form method="post" action="/logout" style="display:inline">
          <button class="btn btn-secondary" type="submit">Выйти</button>
        </form>
      </div>
      {% endif %}
    </div>
    <div class="{{ container_class or 'container' }}">
      {% block content %}{% endblock %}
    </div>
    <script>
      (function () {
        // marker for debugging cache issues
        window.__dt_localize_v = "dt-localize-v1";
        function pad2(n) { return String(n).padStart(2, '0'); }
        function fmt(d) {
          return (
            d.getFullYear() + '-' +
            pad2(d.getMonth() + 1) + '-' +
            pad2(d.getDate()) + ' ' +
            pad2(d.getHours()) + ':' +
            pad2(d.getMinutes()) + ':' +
            pad2(d.getSeconds())
          );
        }
        document.querySelectorAll('.dt[data-dt-utc]').forEach(function (el) {
          try {
            var iso = el.getAttribute('data-dt-utc');
            if (!iso) return;
            var d = new Date(iso); // ISO with Z => treated as UTC, rendered in local TZ
            if (isNaN(d.getTime())) return;
            el.textContent = fmt(d);
          } catch (e) {}
        });
      })();
    </script>
  </body>
</html>
