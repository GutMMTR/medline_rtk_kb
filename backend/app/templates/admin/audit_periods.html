{% extends "base.html" %}
{% block content %}
  <div class="section-header">
    <div>
      <h2 style="margin:0">Периоды аудита</h2>
      <div class="muted">Единый справочник календарных периодов (date_from/date_to). Используется для фильтрации загруженных артефактов.</div>
    </div>
    <div class="row-right">
      <a class="btn btn-secondary" href="/admin">В админку</a>
    </div>
  </div>

  {% if error %}
    <div class="card"><div class="error">{{ error }}</div></div>
  {% endif %}

  <div class="card">
    <h3 style="margin-top:0">Добавить</h3>
    <form method="post" action="/admin/audit-periods" class="grid" style="grid-template-columns: 180px 1fr 180px 180px 160px 160px;">
      <div>
        <label>Код</label>
        <input name="code" placeholder="P365" required />
      </div>
      <div>
        <label>Название</label>
        <input name="name" placeholder="2026 Q1" required />
      </div>
      <div>
        <label>Дата с</label>
        <input name="date_from" type="date" required />
      </div>
      <div>
        <label>Дата по</label>
        <input name="date_to" type="date" required />
      </div>
      <div>
        <label>Сортировка</label>
        <input name="sort_order" type="number" value="0" />
      </div>
      <div>
        <label>Активен</label>
        <select name="is_active">
          <option value="1" selected>Да</option>
          <option value="0">Нет</option>
        </select>
      </div>
      <div class="filter-actions" style="grid-column: 1 / -1">
        <button class="btn" type="submit">Создать</button>
      </div>
    </form>
  </div>

  <div class="card">
    <h3 style="margin-top:0">Список</h3>
    <div class="table-wrap">
      <table class="table">
        <thead>
          <tr>
            <th>Код</th>
            <th>Название</th>
            <th>Дата с</th>
            <th>Дата по</th>
            <th>Сорт</th>
            <th>Активен</th>
            <th style="width:160px"></th>
          </tr>
        </thead>
        <tbody>
          {% for p in periods %}
            <tr>
              <td class="mono">{{ p.code }}</td>
              <td>
                <form method="post" action="/admin/audit-periods/{{ p.id }}" class="row-right" style="justify-content:flex-start; gap:8px">
                  <input name="name" value="{{ p.name }}" required style="min-width:260px" />
                  <input name="date_from" type="date" value="{{ p.date_from|d }}" required style="width:160px" />
                  <input name="date_to" type="date" value="{{ p.date_to|d }}" required style="width:160px" />
                  <input name="sort_order" type="number" value="{{ p.sort_order }}" style="width:110px" />
                  <select name="is_active" style="width:120px">
                    <option value="1" {% if p.is_active %}selected{% endif %}>Да</option>
                    <option value="0" {% if not p.is_active %}selected{% endif %}>Нет</option>
                  </select>
                  <button class="btn btn-secondary" type="submit">Сохранить</button>
                </form>
              </td>
              <td class="mono">{{ p.date_from|d }}</td>
              <td class="mono">{{ p.date_to|d }}</td>
              <td class="mono">{{ p.sort_order }}</td>
              <td>{% if p.is_active %}<span class="badge">Да</span>{% else %}<span class="badge badge-neutral">Нет</span>{% endif %}</td>
              <td></td>
            </tr>
          {% endfor %}
          {% if periods|length == 0 %}
            <tr><td colspan="7" class="muted">Нет периодов.</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}

