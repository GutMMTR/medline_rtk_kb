{% extends "base.html" %}
{% block content %}
  <div class="section-header">
    <div>
      <h2 style="margin:0">–ê—É–¥–∏—Ç ¬∑ –§–∞–π–ª—ã</h2>
      <div class="muted">–ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–æ–≤ –ø–æ –ø–∞–ø–∫–∞–º –∏–∑ ‚Äú–°–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–≥–æ‚Äù (–Ω–∞–ø—Ä–∏–º–µ—Ä: –í–°–°–¢.–ö–ú–ù–ö.1 ‚Üí –í–°–°–¢/–ö–ú–ù–ö/1). –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ.</div>
    </div>
    <div class="row-right">
      <form method="get" action="/auditor/files" class="header-inline-form">
        <input type="hidden" name="path" value="{{ path or '' }}" />
        <label style="margin:0">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</label>
        <select name="org_id" onchange="this.form.submit()">
          {% for o in orgs %}
            <option value="{{ o.id }}" {% if o.id == selected_org_id %}selected{% endif %}>{{ o.name }}</option>
          {% endfor %}
        </select>
      </form>
      <a class="btn btn-secondary" href="/auditor/artifacts?org_id={{ selected_org_id }}">–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã</a>
      <a class="btn btn-secondary" href="/artifacts">–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫</a>
    </div>
  </div>

  <div class="card">
    <div class="breadcrumb">
      <a class="breadcrumb-link" href="/auditor/files?org_id={{ selected_org_id }}">–ö–æ—Ä–µ–Ω—å</a>
      {% for c in crumbs %}
        <span class="muted">/</span>
        <a class="breadcrumb-link" href="/auditor/files?org_id={{ selected_org_id }}&path={{ c.path }}">{{ c.name }}</a>
      {% endfor %}
    </div>
  </div>

  {% if folders|length > 0 %}
    <div class="card">
      <h3>–ü–∞–ø–∫–∏</h3>
      <div class="folder-grid">
        {% for name, cnt in folders %}
          <a class="folder-card" href="/auditor/files?org_id={{ selected_org_id }}&path={{ (path ~ '/' if path else '') ~ name }}">
            <div class="folder-icon">üìÅ</div>
            <div>
              <div class="folder-name mono">{{ name }}</div>
              <div class="muted">—ç–ª–µ–º–µ–Ω—Ç–æ–≤: {{ cnt }}</div>
            </div>
          </a>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  {% if leaf_items|length > 0 %}
    <div class="card">
      <div class="section-header">
        <h3>–§–∞–π–ª—ã / —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è</h3>
        <div class="muted">–¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.</div>
      </div>
      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>–°–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–µ</th>
              <th>–ü—É–Ω–∫—Ç</th>
              <th>–ê—Ä—Ç–µ—Ñ–∞–∫—Ç</th>
              <th class="col-status">–°—Ç–∞—Ç—É—Å</th>
              <th>–§–∞–π–ª</th>
              <th>–î–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏</th>
              <th>–ö—Ç–æ –∑–∞–≥—Ä—É–∑–∏–ª</th>
              <th>–î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è</th>
              <th>–ö—Ç–æ –∏–∑–º–µ–Ω–∏–ª</th>
              <th class="th-actions-wide"></th>
            </tr>
          </thead>
          <tbody>
            {% for r in leaf_items %}
              <tr>
                <td class="mono">{{ r.a.short_name }}</td>
                <td class="mono">{% if r.a.achievement_item_no %}{{ r.a.achievement_item_no }}{% else %}‚Äî{% endif %}</td>
                <td style="min-width:260px">{{ r.a.title }}</td>
                <td class="col-status">
                  {% if r.oa.status.value == "uploaded" %}
                    <span class="badge">–ó–∞–≥—Ä—É–∂–µ–Ω</span>
                  {% else %}
                    <span class="badge badge-danger">–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω</span>
                  {% endif %}
                </td>
                <td class="mono">{% if r.fv %}{{ r.fv.original_filename }}{% else %}‚Äî{% endif %}</td>
                <td class="mono">{% if r.fv %}{{ r.fv.created_at|dt }}{% else %}‚Äî{% endif %}</td>
                <td class="mono">{% if r.uploaded_by %}{{ r.uploaded_by }}{% else %}‚Äî{% endif %}</td>
                <td class="mono">{% if r.oa.updated_at %}{{ r.oa.updated_at|dt }}{% else %}‚Äî{% endif %}</td>
                <td class="mono">{% if r.updated_by %}{{ r.updated_by }}{% else %}‚Äî{% endif %}</td>
                <td class="td-actions-wide">
                  {% if r.oa.status.value == "uploaded" %}
                    <div class="row-right">
                      <a class="icon-btn" href="/auditor/org_artifacts/{{ r.oa.id }}/download" title="–°–∫–∞—á–∞—Ç—å" aria-label="–°–∫–∞—á–∞—Ç—å">
                        <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" focusable="false">
                          <path fill="currentColor" d="M5 20h14v-2H5v2zm7-18-5.5 5.5 1.42 1.42L11 6.84V16h2V6.84l3.08 3.08 1.42-1.42L12 2z"/>
                        </svg>
                      </a>
                      {% if can_delete_files %}
                        <a class="icon-btn" href="/admin/org_artifacts/{{ r.oa.id }}/versions" title="–ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π" aria-label="–ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π">
                          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" focusable="false">
                            <path fill="currentColor" d="M13 3a9 9 0 1 0 8.95 10h-2.02A7 7 0 1 1 13 5V2l4 3-4 3V5z"/>
                            <path fill="currentColor" d="M12 8h2v5h4v2h-6V8z"/>
                          </svg>
                        </a>
                        <form method="post" action="/auditor/org_artifacts/{{ r.oa.id }}/delete" style="display:inline" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª? –°—Ç–∞—Ç—É—Å —Å—Ç–∞–Ω–µ—Ç \"–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω\".')">
                          <input type="hidden" name="back" value="{{ current_url }}" />
                          <button class="icon-btn icon-danger" type="submit" title="–£–¥–∞–ª–∏—Ç—å" aria-label="–£–¥–∞–ª–∏—Ç—å">
                            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" focusable="false">
                              <path fill="currentColor" d="M9 3h6l1 2h4v2H4V5h4l1-2zm-2 4h10l-1 14H8L7 7zm3 3h2v9h-2v-9zm4 0h2v9h-2v-9z"/>
                            </svg>
                          </button>
                        </form>
                      {% endif %}
                    </div>
                  {% else %}
                    <span class="muted">‚Äî</span>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% endif %}

  {% if folders|length == 0 and leaf_items|length == 0 %}
    <div class="card">
      <div class="muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤.</div>
    </div>
  {% endif %}
{% endblock %}

